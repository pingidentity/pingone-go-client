// Copyright © 2025 Ping Identity Corporation

//go:build ignore

package oteltracing

// Package otel_tracing provides a reference implementation for adding OpenTelemetry
// tracing to api_*.go service files. This file is excluded from compilation — it
// exists solely as an annotated guide showing every change required.
//

//     - ReplaceEnvironmentByIdExecute//     - ReplaceBillOfMaterialsByEnvironmentIdExecute//     - GetEnvironmentsExecutePageExecute     ← no environmentID; omit attribute in span//     - GetEnvironmentByIdExecute//     - GetBillOfMaterialsByEnvironmentIdExecute//     - DeleteEnvironmentByIdExecute//     - CreateEnvironmentExecute              ← no environmentID, no 403 retry (skip Step 5)//   pingone/api_environments.go               (7 Execute methods)////     - ReplaceVariableByIdExecute//     - GetVariablesExecutePageExecute  ← no environmentID; omit attribute in span//     - GetVariableByIdExecute//     - DeleteVariableByIdExecute//     - CreateVariableExecute//   pingone/api_da_vinci_variables.go         (5 Execute methods + page variant)////     - ReplaceConnectorInstanceByIdExecute//     - GetDetailsByConnectorIdExecute//     - GetConnectorsExecute//     - GetConnectorInstancesExecute//     - GetConnectorInstanceByIdExecute//     - GetConnectorByIdExecute//     - DeleteConnectorInstanceByIdExecute//     - CreateConnectorInstanceByIdExecute//     - CreateConnectorInstanceExecute//   pingone/api_da_vinci_connectors.go        (9 Execute methods, all have 403 retry)////     - GetVersionsBySnapshotIdExecute//     - GetVersionByIdUsingSnapshotIdExecute//     - GetSnapshotByIdExecute//     - CreateSnapshotExecute//   pingone/api_configuration_management.go   (4 Execute methods, all have 403 retry)//// Apply the above steps to each Execute method in the following files://// ─── PENDING FILES ────────────────────────────────────────────────────────────// what the end result should look like.// Execute method with all five changes applied.  Use it as the ground-truth for// The file pingone/api_directory_total_identities.go contains a fully-instrumented//// ─── COMPLETE EXAMPLE ─────────────────────────────────────────────────────────//   continue//   time.Sleep(1 * time.Second)//   // Retry the request//   )//       ),//           attribute.String("retry.reason", "environment_created_within_30s"),//           attribute.Int("retry.attempt", i),//       trace.WithAttributes(//   span.AddEvent("pingone.retry.environment_not_ready",//   slog.Debug("The environment was created within the last 30 seconds, ...", ...)//// The final snippet looks like:// The span.AddEvent call must come BEFORE the existing `time.Sleep(1 * time.Second)` line.////   )//       ),//           attribute.String("retry.reason", "environment_created_within_30s"),//           attribute.Int("retry.attempt", i),//       trace.WithAttributes(//   span.AddEvent("pingone.retry.environment_not_ready",//// Add the span event immediately AFTER that slog.Debug call:////   slog.Debug("The environment was created within the last 30 seconds, retrying request", ...)//// Locate the line://// (i.e. CreateEnvironment and any method that doesn't call GetEnvironmentById on 403).// SKIP this step for operations that have no 403 environment-check retry loop//// ─── STEP 5 ─── Span event inside the 403 retry block ────────────────────────// This block is identical for every Execute method; copy-paste it verbatim.////   }//       r.xPingExternalSessionID = a.client.sessionID//   if r.xPingExternalSessionID == nil && a.client.sessionID != nil {//   }//       }//           r.xPingExternalTransactionID = &traceID//           traceID := sc.TraceID().String()//       if sc := span.SpanContext(); sc.IsValid() {//   if r.xPingExternalTransactionID == nil {//   // / XPingExternalSessionID.//   // unless the caller has already set them explicitly via XPingExternalTransactionID//   // Auto-populate PingOne correlation headers from the active OTEL trace context//// Insert:////   }//       ...//   if r.xPingExternalSessionID != nil {      ← existing, do not remove//// Immediately AFTER that block, and BEFORE the existing guard:////   }//       localVarHeaderParams["Accept"] = localVarHTTPHeaderAccept//   if localVarHTTPHeaderAccept != "" {//   localVarHTTPHeaderAccept := selectHeaderAccept(localVarHTTPHeaderAccepts)//// Locate the block that checks whether to add the Accept header, which looks like://// ─── STEP 4 ─── Auto-populate X-Ping-External-* headers ─────────────────────//   "pingone.ConfigurationManagement.CreateSnapshot"//   "pingone.DaVinciVariables.CreateVariable"//   "pingone.DaVinciConnectors.GetConnectorById"//   "pingone.Environments.GetEnvironmentById"//   "pingone.Environments.CreateEnvironment"// Examples:////   Operation name = the Go method name without "Execute", e.g. "CreateEnvironment"//   Service name  = the struct name prefix, e.g. "Environments", "DaVinciConnectors"// Span name convention: "pingone.<ServiceName>.<OperationName>"////   r.ctx = ctx//   }()//       span.End()//       recordSpanError(span, retErr)//   defer func() {//   )//       trace.WithSpanKind(trace.SpanKindClient),//   ctx, span := a.client.startSpan(r.ctx, "pingone.<ServiceName>.<OperationName>",//// Operations with NO environmentID (e.g. CreateEnvironment, GetEnvironments):////   r.ctx = ctx//   }()//       span.End()//       recordSpanError(span, retErr)//   defer func() {//   )//       trace.WithAttributes(attribute.String("pingone.environment_id", r.environmentID.String())),//       trace.WithSpanKind(trace.SpanKindClient),//   ctx, span := a.client.startSpan(r.ctx, "pingone.<ServiceName>.<OperationName>",//// Operations that carry an environmentID parameter (most of them)://// Insert the span code immediately after that closing brace.// localVarReturnValue is always the very first thing in an Execute method body.// The var block that declares localVarHTTPMethod, localVarPostBody, formFiles, and//// ─── STEP 3 ─── Span creation (insert after the var block) ───────────────────// closure in Step 3.  The blank identifiers `_` keep the API surface identical.// The named return `retErr` is the error variable captured by the deferred span////   func (a *ExampleApiService) DoSomethingExecute(r ApiDoSomethingRequest) (_ *SomeResponseType, _ *http.Response, retErr error) {//// AFTER:////   func (a *ExampleApiService) DoSomethingExecute(r ApiDoSomethingRequest) (*SomeResponseType, *http.Response, error) {//// BEFORE (generated)://// ─── STEP 2 ─── Named return on the Execute signature ────────────────────────//   )//       "go.opentelemetry.io/otel/trace"       // ← ADD//       "go.opentelemetry.io/otel/attribute"   // ← ADD//       ...//   import (//// stay unchanged.// there already.  The other existing imports (bytes, context, errors, io, …)// Add these two lines to the import block of the api_*.go file if they are not//// ─── STEP 1 ─── Import additions ─────────────────────────────────────────────package otel_tracing//     such as CreateEnvironment.)//     (Omit this step for operations that have no 403 environment-check retry,//  5. Add a span event inside the 403 "environment created within 30s" retry block.////     and before the existing "if r.xPingExternalSessionID != nil" guard.//  4. Auto-populate the X-Ping-External-* headers after the Accept header is set,////  3. Start a span immediately after the var block (before ServerURLWithContext).////  2. Change the function signature to use named returns.////     "go.opentelemetry.io/otel/trace"//     "go.opentelemetry.io/otel/attribute"//  1. Add two imports (if not already present)://// # Summary of changes per Execute method//// See the canonical completed example: pingone/api_directory_total_identities.go
